<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AyurScan ‚Äî Vedic Food Wisdom</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --saffron: #E8873A;
    --turmeric: #D4A017;
    --deep-green: #1A2E1A;
    --sage: #6B7E52;
    --cream: #FAF5EB;
    --warm-white: #FFF9F0;
    --terracotta: #C1673C;
    --light-sage: #E8EFE0;
    --dark-text: #1C1A14;
    --muted: #7A7060;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--cream); color: var(--dark-text); font-family: 'DM Sans', sans-serif; min-height: 100vh; overflow-x: hidden; }
  body::before {
    content: ''; position: fixed; inset: 0; pointer-events: none; z-index: 0;
    background-image:
      radial-gradient(circle at 20% 20%, rgba(232,135,58,0.08) 0%, transparent 50%),
      radial-gradient(circle at 80% 80%, rgba(107,126,82,0.08) 0%, transparent 50%);
  }

  header { position: relative; z-index: 10; text-align: center; padding: 50px 20px 30px; border-bottom: 1px solid rgba(212,160,23,0.2); }
  .mandala-ring { width: 80px; height: 80px; margin: 0 auto 20px; }
  .mandala-ring svg { width: 100%; height: 100%; animation: spin-slow 20s linear infinite; }
  @keyframes spin-slow { to { transform: rotate(360deg); } }
  .brand { font-family: 'Cormorant Garamond', serif; font-size: 3rem; font-weight: 300; color: var(--deep-green); letter-spacing: 0.05em; line-height: 1; }
  .brand span { color: var(--saffron); font-style: italic; }
  .tagline { margin-top: 8px; font-size: 0.85rem; font-weight: 300; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); }

  main { position: relative; z-index: 5; max-width: 860px; margin: 0 auto; padding: 50px 20px 80px; }
  .info-strip { display: flex; gap: 16px; margin-bottom: 40px; flex-wrap: wrap; }
  .info-chip { display: flex; align-items: center; gap: 8px; background: var(--warm-white); border: 1px solid rgba(212,160,23,0.2); border-radius: 24px; padding: 8px 18px; font-size: 0.8rem; color: var(--dark-text); font-weight: 300; }
  .section-title { font-family: 'Cormorant Garamond', serif; font-size: 1.6rem; font-weight: 400; color: var(--deep-green); margin-bottom: 6px; }
  .section-sub { font-size: 0.85rem; color: var(--muted); margin-bottom: 24px; font-weight: 300; }

  .camera-trigger { border: 2px dashed rgba(212,160,23,0.4); border-radius: 16px; background: rgba(255,249,240,0.8); padding: 60px 40px; text-align: center; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; }
  .camera-trigger:hover { border-color: var(--saffron); transform: translateY(-2px); box-shadow: 0 12px 40px rgba(232,135,58,0.15); }
  .camera-trigger .icon { font-size: 3.5rem; display: block; margin-bottom: 16px; filter: drop-shadow(0 4px 8px rgba(232,135,58,0.3)); }
  .camera-trigger h3 { font-family: 'Cormorant Garamond', serif; font-size: 1.5rem; font-weight: 400; color: var(--deep-green); margin-bottom: 8px; }
  .camera-trigger p { font-size: 0.85rem; color: var(--muted); font-weight: 300; }

  .preview-container { display: none; }
  .preview-container.show { display: block; }
  .preview-img { width: 100%; max-height: 400px; object-fit: cover; border-radius: 12px; box-shadow: 0 8px 32px rgba(28,26,20,0.12); }
  .preview-actions { margin-top: 12px; display: flex; align-items: center; gap: 12px; }
  .captured-badge { background: rgba(26,46,26,0.85); color: white; padding: 6px 14px; border-radius: 20px; font-size: 0.75rem; font-weight: 500; }
  .retake-btn { background: none; border: 1px solid rgba(232,135,58,0.45); color: var(--saffron); padding: 7px 20px; border-radius: 20px; font-size: 0.82rem; cursor: pointer; font-family: 'DM Sans', sans-serif; transition: all 0.2s; }
  .retake-btn:hover { background: rgba(232,135,58,0.06); }

  .analyze-btn { width: 100%; padding: 18px 40px; background: linear-gradient(135deg, var(--deep-green) 0%, #2C4A2C 100%); color: var(--cream); border: none; border-radius: 12px; font-family: 'Cormorant Garamond', serif; font-size: 1.3rem; font-weight: 400; letter-spacing: 0.05em; cursor: pointer; transition: all 0.3s ease; margin-top: 24px; position: relative; overflow: hidden; }
  .analyze-btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(232,135,58,0.2), transparent); transition: left 0.5s; }
  .analyze-btn:hover::before { left: 100%; }
  .analyze-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 32px rgba(26,46,26,0.3); }
  .analyze-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  .loading-state { display: none; text-align: center; padding: 60px 20px; }
  .loading-state.show { display: block; animation: fadeIn 0.4s ease; }
  .spinner-wrap { position: relative; width: 80px; height: 80px; margin: 0 auto 24px; }
  .spinner-outer { width: 80px; height: 80px; border: 3px solid rgba(212,160,23,0.2); border-top-color: var(--turmeric); border-radius: 50%; animation: spin 1s linear infinite; position: absolute; }
  .spinner-inner { width: 54px; height: 54px; border: 2px solid rgba(232,135,58,0.15); border-bottom-color: var(--saffron); border-radius: 50%; animation: spin 0.7s linear infinite reverse; position: absolute; top: 13px; left: 13px; }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-text { font-family: 'Cormorant Garamond', serif; font-size: 1.3rem; color: var(--deep-green); margin-bottom: 8px; }
  .loading-sub { font-size: 0.82rem; color: var(--muted); font-weight: 300; animation: pulse 2s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{opacity:0.5} 50%{opacity:1} }

  .result-section { display: none; }
  .result-section.show { display: block; animation: fadeSlideUp 0.6s ease; }
  @keyframes fadeSlideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  .verdict-banner { padding: 28px 36px; border-radius: 16px; margin-bottom: 28px; display: flex; align-items: center; gap: 20px; position: relative; overflow: hidden; }
  .verdict-banner::after { content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, transparent 60%); pointer-events: none; }
  .verdict-banner.compatible { background: linear-gradient(135deg, #1A3A1A, #2E5C2E); color: white; box-shadow: 0 12px 40px rgba(26,58,26,0.35); }
  .verdict-banner.incompatible { background: linear-gradient(135deg, #5C1A0A, #A03020); color: white; box-shadow: 0 12px 40px rgba(92,26,10,0.35); }
  .verdict-banner.moderate { background: linear-gradient(135deg, #3A2E00, #7A5E00); color: white; box-shadow: 0 12px 40px rgba(58,46,0,0.35); }
  .verdict-icon { font-size: 3rem; flex-shrink: 0; }
  .verdict-text h2 { font-family: 'Cormorant Garamond', serif; font-size: 2rem; font-weight: 600; margin-bottom: 4px; }
  .verdict-text p { font-size: 0.9rem; opacity: 0.85; font-weight: 300; line-height: 1.5; }

  .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
  @media (max-width: 600px) { .result-grid { grid-template-columns: 1fr; } .brand { font-size: 2.2rem; } }
  .result-card { background: var(--warm-white); border: 1px solid rgba(212,160,23,0.2); border-radius: 14px; padding: 24px; }
  .result-card.full-width { grid-column: 1 / -1; }
  .card-label { font-size: 0.7rem; font-weight: 500; letter-spacing: 0.15em; text-transform: uppercase; color: var(--saffron); margin-bottom: 10px; }
  .card-content { font-family: 'Cormorant Garamond', serif; font-size: 1.05rem; font-weight: 300; color: var(--dark-text); line-height: 1.7; }
  .card-content ul { list-style: none; padding: 0; }
  .card-content ul li { padding: 5px 0 5px 18px; position: relative; border-bottom: 1px solid rgba(212,160,23,0.1); font-size: 1rem; }
  .card-content ul li:last-child { border-bottom: none; }
  .card-content ul li::before { content: '‚Ä¢'; color: var(--turmeric); position: absolute; left: 0; }
  .dosha-pills { display: flex; gap: 8px; flex-wrap: wrap; }
  .dosha-pill { padding: 4px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 500; font-family: 'DM Sans', sans-serif; }
  .dosha-pill.vata { background: rgba(100,149,237,0.15); color: #3A5AA0; border: 1px solid rgba(100,149,237,0.3); }
  .dosha-pill.pitta { background: rgba(220,80,40,0.1); color: #A03020; border: 1px solid rgba(220,80,40,0.25); }
  .dosha-pill.kapha { background: rgba(80,140,80,0.1); color: #2A6A2A; border: 1px solid rgba(80,140,80,0.25); }
  .score-bar-bg { height: 8px; background: rgba(212,160,23,0.15); border-radius: 4px; overflow: hidden; margin-top: 8px; }
  .score-bar-fill { height: 100%; border-radius: 4px; transition: width 1s ease; background: linear-gradient(90deg, var(--turmeric), var(--saffron)); }
  .score-label { display: flex; justify-content: space-between; font-size: 0.78rem; color: var(--muted); margin-top: 4px; }
  .error-msg { background: rgba(193,103,60,0.1); border: 1px solid rgba(193,103,60,0.3); border-radius: 12px; padding: 16px 20px; margin-top: 16px; color: var(--terracotta); display: none; font-size: 0.95rem; line-height: 1.6; }
  .error-msg.show { display: block; }
  .reset-btn { display: block; margin: 28px auto 0; background: none; border: 2px solid rgba(26,46,26,0.25); color: var(--deep-green); padding: 12px 32px; border-radius: 10px; font-family: 'Cormorant Garamond', serif; font-size: 1.1rem; cursor: pointer; transition: all 0.2s; }
  .reset-btn:hover { border-color: var(--deep-green); background: var(--light-sage); }
  .disclaimer { text-align: center; font-size: 0.75rem; color: var(--muted); margin-top: 40px; padding: 20px; border-top: 1px solid rgba(212,160,23,0.15); line-height: 1.6; }

  /* FULL-SCREEN CAMERA */
  .camera-overlay { display: none; position: fixed; inset: 0; background: #000; z-index: 3000; }
  .camera-overlay.open { display: block; }
  #cameraVideo { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
  canvas { display: none; }
  .cam-topbar { position: absolute; top: 0; left: 0; right: 0; z-index: 10; display: flex; align-items: center; justify-content: space-between; padding: 48px 24px 20px; background: linear-gradient(to bottom, rgba(0,0,0,0.65), transparent); }
  .cam-icon-btn { width: 44px; height: 44px; border-radius: 50%; background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.22); color: white; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(6px); transition: all 0.2s; }
  .cam-icon-btn:hover { background: rgba(255,255,255,0.22); }
  .cam-face-badge { font-size: 0.7rem; letter-spacing: 0.18em; color: rgba(255,255,255,0.75); background: rgba(0,0,0,0.38); padding: 5px 14px; border-radius: 10px; backdrop-filter: blur(6px); }
  .cam-guides { position: absolute; inset: 0; pointer-events: none; z-index: 5; }
  .g-corner { position: absolute; width: 32px; height: 32px; border-color: rgba(212,160,23,0.8); border-style: solid; }
  .g-corner.tl { top: 90px; left: 20px; border-width: 3px 0 0 3px; }
  .g-corner.tr { top: 90px; right: 20px; border-width: 3px 3px 0 0; }
  .g-corner.bl { bottom: 150px; left: 20px; border-width: 0 0 3px 3px; }
  .g-corner.br { bottom: 150px; right: 20px; border-width: 0 3px 3px 0; }
  .g-dot { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); width: 10px; height: 10px; border-radius: 50%; border: 2px solid rgba(212,160,23,0.55); }
  .cam-bottombar { position: absolute; bottom: 0; left: 0; right: 0; z-index: 10; padding: 20px 40px 52px; background: linear-gradient(to top, rgba(0,0,0,0.7), transparent); display: flex; align-items: center; justify-content: center; }
  .shutter { width: 82px; height: 82px; border-radius: 50%; background: transparent; border: 5px solid rgba(255,255,255,0.9); cursor: pointer; position: relative; transition: transform 0.12s; box-shadow: 0 0 0 3px rgba(212,160,23,0.35), 0 0 28px rgba(0,0,0,0.4); }
  .shutter::after { content: ''; position: absolute; inset: 8px; border-radius: 50%; background: white; }
  .shutter:active { transform: scale(0.9); }
  .flash-fx { position: absolute; inset: 0; background: white; opacity: 0; pointer-events: none; z-index: 20; transition: opacity 0.05s; }
  .flash-fx.on { opacity: 1; }
  .cam-err { display: none; position: absolute; inset: 0; background: #0C0A06; z-index: 30; flex-direction: column; align-items: center; justify-content: center; color: rgba(255,255,255,0.65); text-align: center; gap: 14px; padding: 40px; }
  .cam-err.show { display: flex; }
  .cam-err-icon { font-size: 3.5rem; }
  .cam-err-title { font-family: 'Cormorant Garamond', serif; font-size: 1.5rem; color: rgba(255,255,255,0.9); }
  .cam-err-msg { font-size: 0.84rem; font-weight: 300; line-height: 1.7; max-width: 280px; }
  .cam-err-close { margin-top: 8px; background: rgba(232,135,58,0.18); border: 1px solid rgba(232,135,58,0.45); color: var(--saffron); padding: 10px 28px; border-radius: 20px; cursor: pointer; font-family: 'DM Sans', sans-serif; font-size: 0.85rem; }
</style>
</head>
<body>

<!-- FULL-SCREEN CAMERA -->
<div class="camera-overlay" id="camOverlay">
  <video id="cameraVideo" autoplay playsinline muted></video>
  <canvas id="captureCanvas"></canvas>
  <div class="cam-guides">
    <div class="g-corner tl"></div>
    <div class="g-corner tr"></div>
    <div class="g-corner bl"></div>
    <div class="g-corner br"></div>
    <div class="g-dot"></div>
  </div>
  <div class="cam-topbar">
    <button class="cam-icon-btn" onclick="closeCamera()">‚úï</button>
    <span class="cam-face-badge" id="facingBadge">REAR CAMERA</span>
    <button class="cam-icon-btn" onclick="flipCamera()">üîÑ</button>
  </div>
  <div class="cam-bottombar">
    <button class="shutter" onclick="capturePhoto()"></button>
  </div>
  <div class="flash-fx" id="flashFx"></div>
  <div class="cam-err" id="camErr">
    <span class="cam-err-icon">üì∑</span>
    <p class="cam-err-title">Camera Unavailable</p>
    <p class="cam-err-msg">Please allow camera permissions in your browser settings and try again.</p>
    <button class="cam-err-close" onclick="closeCamera()">Close</button>
  </div>
</div>

<!-- HEADER -->
<header>
  <div class="mandala-ring">
    <svg viewBox="0 0 100 100" fill="none">
      <circle cx="50" cy="50" r="45" stroke="#D4A017" stroke-width="1" stroke-dasharray="4 4"/>
      <circle cx="50" cy="50" r="35" stroke="#E8873A" stroke-width="0.8" stroke-dasharray="2 6"/>
      <circle cx="50" cy="50" r="22" stroke="#6B7E52" stroke-width="1"/>
      <path d="M50 5 L53 28 L50 50 L47 28Z" fill="#D4A017" opacity="0.6"/>
      <path d="M50 95 L53 72 L50 50 L47 72Z" fill="#D4A017" opacity="0.6"/>
      <path d="M5 50 L28 53 L50 50 L28 47Z" fill="#E8873A" opacity="0.6"/>
      <path d="M95 50 L72 53 L50 50 L72 47Z" fill="#E8873A" opacity="0.6"/>
      <circle cx="50" cy="50" r="6" fill="#1A2E1A"/>
      <circle cx="50" cy="50" r="3" fill="#D4A017"/>
    </svg>
  </div>
  <div class="brand">Ayur<span>Scan</span></div>
  <div class="tagline">Ancient Wisdom ¬∑ Modern Vision</div>
</header>

<main>
  <div class="info-strip">
    <div class="info-chip"><span>üåø</span> Ayurvedic Principles</div>
    <div class="info-chip"><span>üì∑</span> Live Camera Scan</div>
    <div class="info-chip"><span>‚öïÔ∏è</span> Dosha Compatibility</div>
  </div>

  <div style="margin-bottom:40px">
    <h2 class="section-title">Scan Your Meal</h2>
    <p class="section-sub">Point your camera at your food to receive ancient Ayurvedic wisdom on its compatibility</p>

    <div class="camera-trigger" id="cameraTrigger" onclick="openCamera()">
      <span class="icon">üì∑</span>
      <h3>Tap to Open Camera</h3>
      <p>Point your camera at your meal and press the shutter</p>
    </div>

    <div class="preview-container" id="previewContainer">
      <img id="previewImg" class="preview-img" src="" alt="Captured meal">
      <div class="preview-actions">
        <span class="captured-badge">‚úì Photo captured</span>
        <button class="retake-btn" onclick="retake()">üì∑ Retake</button>
      </div>
    </div>

    <div class="error-msg" id="errorMsg"></div>

    <button class="analyze-btn" id="analyzeBtn" onclick="analyzeFood()" disabled>
      üî¨ Consult the Vedic Oracle
    </button>
  </div>

  <div class="loading-state" id="loadingState">
    <div class="spinner-wrap">
      <div class="spinner-outer"></div>
      <div class="spinner-inner"></div>
    </div>
    <p class="loading-text">Consulting ancient scriptures‚Ä¶</p>
    <p class="loading-sub" id="loadingSubText">Identifying ingredients in your meal</p>
  </div>

  <div class="result-section" id="resultSection">
    <div class="verdict-banner" id="verdictBanner">
      <div class="verdict-icon" id="verdictIcon"></div>
      <div class="verdict-text">
        <h2 id="verdictTitle"></h2>
        <p id="verdictSubtitle"></p>
      </div>
    </div>
    <div class="result-grid">
      <div class="result-card">
        <div class="card-label">Identified Foods</div>
        <div class="card-content" id="identifiedFoods"></div>
      </div>
      <div class="result-card">
        <div class="card-label">Dosha Impact</div>
        <div class="card-content" id="doshaImpact"></div>
      </div>
      <div class="result-card full-width">
        <div class="card-label">Ayurvedic Analysis</div>
        <div class="card-content" id="ayurvedaAnalysis"></div>
      </div>
      <div class="result-card">
        <div class="card-label">‚ö† Cautions</div>
        <div class="card-content" id="cautions"></div>
      </div>
      <div class="result-card">
        <div class="card-label">‚ú® Suggestions</div>
        <div class="card-content" id="suggestions"></div>
      </div>
      <div class="result-card full-width">
        <div class="card-label">Compatibility Score</div>
        <div class="card-content">
          <div style="font-size:1.4rem;font-weight:600;" id="scoreNum">‚Äî</div>
          <div class="score-bar-bg"><div class="score-bar-fill" id="scoreBar" style="width:0%"></div></div>
          <div class="score-label"><span>Incompatible</span><span>Highly Compatible</span></div>
        </div>
      </div>
    </div>
    <button class="reset-btn" onclick="resetAll()">üì∑ Scan Another Meal</button>
  </div>

  <p class="disclaimer">
    AyurScan draws on classical Ayurvedic texts including Charaka Samhita and Ashtanga Hridayam.<br>
    This tool is for educational purposes only and does not constitute medical advice.<br>
    Always consult a qualified Ayurvedic practitioner for personalised health guidance.
  </p>
</main>

<script>
  let base64Image = null;
  let cameraStream = null;
  let facingMode = 'environment';

  async function openCamera() {
    document.getElementById('camOverlay').classList.add('open');
    document.getElementById('camErr').classList.remove('show');
    await startStream();
  }

  async function startStream() {
    if (cameraStream) { cameraStream.getTracks().forEach(t => t.stop()); cameraStream = null; }
    const video = document.getElementById('cameraVideo');
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode, width: { ideal: 1920 }, height: { ideal: 1440 } },
        audio: false
      });
      cameraStream = stream;
      video.srcObject = stream;
      document.getElementById('camErr').classList.remove('show');
      document.getElementById('facingBadge').textContent = facingMode === 'environment' ? 'REAR CAMERA' : 'FRONT CAMERA';
    } catch (e) {
      video.style.display = 'none';
      document.getElementById('camErr').classList.add('show');
    }
  }

  function flipCamera() {
    facingMode = facingMode === 'environment' ? 'user' : 'environment';
    startStream();
  }

  function capturePhoto() {
    const video = document.getElementById('cameraVideo');
    const canvas = document.getElementById('captureCanvas');
    if (!cameraStream || !video.videoWidth) return;
    const flash = document.getElementById('flashFx');
    flash.classList.add('on');
    setTimeout(() => flash.classList.remove('on'), 130);
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    if (facingMode === 'user') {
      ctx.save(); ctx.scale(-1, 1);
      ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
      ctx.restore();
    } else {
      ctx.drawImage(video, 0, 0);
    }
    const dataURL = canvas.toDataURL('image/jpeg', 0.92);
    base64Image = dataURL.split(',')[1];
    document.getElementById('previewImg').src = dataURL;
    document.getElementById('previewContainer').classList.add('show');
    document.getElementById('cameraTrigger').style.display = 'none';
    document.getElementById('analyzeBtn').disabled = false;
    document.getElementById('errorMsg').classList.remove('show');
    setTimeout(closeCamera, 200);
  }

  function closeCamera() {
    document.getElementById('camOverlay').classList.remove('open');
    if (cameraStream) { cameraStream.getTracks().forEach(t => t.stop()); cameraStream = null; }
  }

  function retake() {
    base64Image = null;
    document.getElementById('previewContainer').classList.remove('show');
    document.getElementById('cameraTrigger').style.display = '';
    document.getElementById('analyzeBtn').disabled = true;
    document.getElementById('errorMsg').classList.remove('show');
    openCamera();
  }

  function resetAll() {
    base64Image = null;
    document.getElementById('previewContainer').classList.remove('show');
    document.getElementById('cameraTrigger').style.display = '';
    document.getElementById('analyzeBtn').disabled = true;
    document.getElementById('errorMsg').classList.remove('show');
    document.getElementById('resultSection').classList.remove('show');
    document.getElementById('loadingState').classList.remove('show');
    closeCamera();
  }

  const loadingMessages = [
    'Identifying ingredients in your meal‚Ä¶',
    'Cross-referencing Charaka Samhita‚Ä¶',
    'Analysing Viruddha Ahara principles‚Ä¶',
    'Computing dosha compatibility‚Ä¶',
    'Consulting ancient Ayurvedic texts‚Ä¶'
  ];
  let msgInterval;

  async function analyzeFood() {
    if (!base64Image) return;
    document.getElementById('resultSection').classList.remove('show');
    document.getElementById('errorMsg').classList.remove('show');
    document.getElementById('loadingState').classList.add('show');
    document.getElementById('analyzeBtn').disabled = true;
    let idx = 0;
    const sub = document.getElementById('loadingSubText');
    msgInterval = setInterval(() => { idx = (idx + 1) % loadingMessages.length; sub.textContent = loadingMessages[idx]; }, 2000);
    try {
      const res = await fetch('/api/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ imageBase64: base64Image, mediaType: 'image/jpeg' })
      });
      clearInterval(msgInterval);
      const result = await res.json();
      if (!res.ok) throw new Error(result.error || 'Server error');
      displayResults(result);
    } catch (e) {
      clearInterval(msgInterval);
      document.getElementById('loadingState').classList.remove('show');
      document.getElementById('analyzeBtn').disabled = false;
      const el = document.getElementById('errorMsg');
      el.textContent = '‚ö† ' + (e.message || 'Something went wrong. Please try again.');
      el.classList.add('show');
    }
  }

  function displayResults(r) {
    document.getElementById('loadingState').classList.remove('show');
    const banner = document.getElementById('verdictBanner');
    banner.className = 'verdict-banner ' + (r.compatibility || 'moderate');
    const icons = { compatible:'‚úÖ', incompatible:'‚õî', moderate:'‚ö°' };
    document.getElementById('verdictIcon').textContent = icons[r.compatibility] || '‚ö°';
    document.getElementById('verdictTitle').textContent = r.verdict_title || 'Analysis Complete';
    document.getElementById('verdictSubtitle').textContent = r.verdict_subtitle || '';
    const foods = Array.isArray(r.identified_foods) ? r.identified_foods : [];
    document.getElementById('identifiedFoods').innerHTML = foods.length ? `<ul>${foods.map(f=>`<li>${f}</li>`).join('')}</ul>` : '<em>Could not identify items</em>';
    const de = r.dosha_effects || {};
    document.getElementById('doshaImpact').innerHTML = `
      <div class="dosha-pills">
        <span class="dosha-pill vata">VƒÅta: ${de.vata||'‚Äî'}</span>
        <span class="dosha-pill pitta">Pitta: ${de.pitta||'‚Äî'}</span>
        <span class="dosha-pill kapha">Kapha: ${de.kapha||'‚Äî'}</span>
      </div>
      <p style="margin-top:12px;font-size:0.95rem;line-height:1.6;color:#4A4030">${r.dosha_notes||''}</p>`;
    document.getElementById('ayurvedaAnalysis').innerHTML = `<p style="line-height:1.8">${r.ayurveda_analysis||''}</p>`;
    const cautions = Array.isArray(r.cautions) ? r.cautions : [];
    document.getElementById('cautions').innerHTML = cautions.length ? `<ul>${cautions.map(c=>`<li>${c}</li>`).join('')}</ul>` : '<em>No significant cautions</em>';
    const suggestions = Array.isArray(r.suggestions) ? r.suggestions : [];
    document.getElementById('suggestions').innerHTML = suggestions.length ? `<ul>${suggestions.map(s=>`<li>${s}</li>`).join('')}</ul>` : '<em>No additional suggestions</em>';
    const score = Math.min(100, Math.max(0, parseInt(r.compatibility_score) || 50));
    document.getElementById('scoreNum').textContent = score + ' / 100';
    setTimeout(() => { document.getElementById('scoreBar').style.width = score + '%'; }, 100);
    document.getElementById('resultSection').classList.add('show');
    document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
    document.getElementById('analyzeBtn').disabled = false;
  }
</script>
</body>
</html>
